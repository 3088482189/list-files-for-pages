<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>zcmimi的文件床</title>
    <subtitle>/</subtitle>
    <link rel="stylesheet" href="/add/mdui/css/mdui.min.css" />

    <!-- markdown katex-->
	<link rel="stylesheet" href="/add/markdown2.css" />
	<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
		integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
		integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz"
        crossorigin="anonymous"></script>
    <script>
        function md_turn(input, output) {
			var text = window.document.getElementById(input).value.trim(), res = "";
			var list = text.split("$$");
			var tmp = "";
			for (i in list) {
				if (i & 1) res += katex.renderToString(list[i], { displayMode: true });
				else {
					var LIST = list[i].split('$'), now = "";
					for (j in LIST) {
						if (j & 1) now += '<latex>' + katex.renderToString(LIST[j]) + '</latex>';
						else now += LIST[j];
					}
					res += marked(now);
				}
			}
			window.document.getElementById(output).innerHTML = res;
		}
    </script>
</head>

<body class='mdui-theme-accent-blue'>
    <div id="content-left" class='left-body mdui-appbar-with-toolbar padding-top'>
        <div class='mdui-appbar mdui-shadow-2 mdui-appbar-fixed' style='width: 30%'>
            <div class='mdui-toolbar mdui-color-white'> <a href='/f_index.html' class='mdui-btn mdui-btn-icon'><i
                        class='mdui-icon material-icons'>home</i></a> <span class='mdui-text' id='path'
                    style='text-overflow: clip !important;overflow: scroll;'>zcmimi's files</span>
                <div class='mdui-toolbar-spacer'></div> <button id='filter_button'
                    class='mdui-btn mdui-btn-icon mdui-ripple' onclick='view_filter_textfield()'> <i
                        class='mdui-icon material-icons'>filter_list</i> </button>
                <div id='filter_textfield' class='mdui-textfield' style='display: none;'> <input id='filter_input'
                        class='mdui-textfield-input' placeholder='筛选,多关键词请用|分割'> </div>
            </div>
        </div>
        <p></p>
        <ul id="list" class="mdui-list">

        </ul>
        <div class="mdui-bottom-nav"></div>
    </div>
    <div id="content-right" class='right-body'>
        <script src="/add/jq.js"></script>
        
        <!--highlight-->
        <link rel="stylesheet" href="/add/github.min.css">
        <script src="/add/highlight.min.js"></script>
        <script src="/add/highlightjs-line-numbers.min.js"></script>
        <script src="/add/highlightjs-copy-button.min.js"></script>
        <!--highlight end-->

        <div class="mdui-subheader-inset">preview--(support markdown and code)</div>
        <a id="preview-raw" href="" style="display: none;">
            <li class="mdui-list-item">
                <i class="mdui-list-item-icon mdui-color-white"><img src="/add/icon/download.svg"></i>
                <div id='download_file_name' class="mdui-list-item mdui-text-color-black">下载</div>
            </li>
        </a>

        <textarea id="md_source" style="display: none;"></textarea>
        <div id="md_out"></div>
        <div id="loading" style="display: none;">loading...</div>
        <script>
            function viewmd(file) {
                var link = new XMLHttpRequest();
                $('#download_file_name').html("下载" + file)
                $('#preview-raw').attr('href', file);
                $('#preview-raw').hide()
                link.onreadystatechange = function () {
                    $('#md_out').hide();
                    $('#loading').show()
                    $('#preview-raw').show()
                    if (link.readyState == 4) {
                        $('#md_source').html(link.responseText);
                        md_turn('md_source', 'md_out');
                        $('pre code').each(function (i, block) {
                            hljs.highlightBlock(block);
                        });
                        hljs.initCopyButtonOnLoad();
                        hljs.initLineNumbersOnLoad();
                        console.log('done');
                        $('#loading').hide()
                        $('#md_out').show();
                    }
                }
                link.open('GET', file, true);
                link.send();
            }

            function viewcode(typ, file) {
                var link = new XMLHttpRequest();
                $('#download_file_name').html("下载" + file)
                $('#preview-raw').attr('href', file);
                $('#preview-raw').hide()
                link.onreadystatechange = function () {
                    $('#md_out').hide();
                    $('#loading').show()
                    $('#preview-raw').show()
                    if (link.readyState == 4) {
                        $('#md_source').html("```" + typ + "\n" + link.responseText + "\n```\n");
                        md_turn('md_source', 'md_out');
                        $('pre code').each(function (i, block) {
                            hljs.highlightBlock(block);
                        });
                        hljs.initCopyButtonOnLoad();
                        hljs.initLineNumbersOnLoad();
                        console.log('done');
                        $('#loading').hide()
                        $('#md_out').show();
                    }
                }
                link.open('GET', file, true);
                link.send();
            }

            function filter() {
                $(".obj").each(function () {
                    $(this).show();
                });
                var arr = $('#filter_input').val().split('|');
                $.each(arr, function (index, text) {
                    text = text.toLowerCase()
                    $(".obj").each(function () {
                        if ($(this).html().toLowerCase().indexOf(text) == -1)
                            $(this).hide();
                    });
                });
            }
            $('#filter_input').change(function () {
                filter();
            });

            var is_filter_textfield_hide = 1,
                is_search_textfield_hide = 1;

            function view_filter_textfield() {
                if (is_filter_textfield_hide) $('#filter_textfield').show();
                else $('#filter_textfield').hide();
                is_filter_textfield_hide ^= 1;
            }

            function view_search_textfield() {
                if (is_search_textfield_hide) $('#search_textfield').show();
                else $('#search_textfield').hide();
                is_search_textfield_hide ^= 1;
            }
            $('#path').click(function () {
                $(this).animate({
                    scrollLeft: $(this).scrollLeft() + $('.mdui-toolbar').width() / 3
                }, 1000)
            });

            function geturl(val) {
                var query = window.location.search.substring(1);
                var vars = query.split("&");
                for (var i = 0; i < vars.length; i++) {
                    var pair = vars[i].split("=");
                    if (pair[0] == val){
                        return pair[1];
                    }
                }
                return "";
            }
            icon_other =  "<img src=\"/add/icon/x.svg\"></img>"
            icon_pdf =    "<img src=\"/add/icon/x-pdf.svg\"></img>"
            icon_markdown="<img src=\"/add/icon/txt-md.svg\"></img>"
            icon_txt =    "<img src=\"/add/icon/txt.svg\"></img>"
            icon_bin =    "<img src=\"/add/icon/bin.svg\"></img>"
            icon_html =   "<img src=\"/add/icon/txt-html.svg\"></img>"
            icon_css =    "<img src=\"/add/icon/txt-css.svg\"></img>"
            icon_js =     "<img src=\"/add/icon/txt-js.svg\"></img>"
            icon_py =     "<img src=\"/add/icon/txt-py.svg\"></img>"
            icon_shell =  "<img src=\"/add/icon/txt-script.svg\"></img>"
            icon_cpp =    "<img src=\"/add/icon/txt-cpp.svg\"></img>"
            icon_go =     "<img src=\"/add/icon/txt-go.svg\"></img>"
            icon_photo =  "<img src=\"/add/icon/img.svg\"></img>"
            icon_video =  "<img src=\"/add/icon/vid.svg\"></img>"
            icon_zip =    "<img src=\"/add/icon/ar.svg\"></img>"
            icon_deb =    "<img src=\"/add/icon/ar-deb.svg\"></img>"
            icon_rpm =    "<img src=\"/add/icon/ar-rpm.svg\"></img>"
            icon_apk =    "<img src=\"/add/icon/ar-apk.svg\"></img>"

            function search(){
                var dir=geturl("dir"),text=unescape(geturl("text")).split('|'),tot=0;
                console.log(dir+','+text);
                var s=$.ajax({url:"/search.txt",async:false}).responseText;
                var items=s.split("|-|=|-|");
                console.log(items.length);
                for(i in items){
                    node=items[i];
                    var tmp=node.split("|-|-|-|")
                    var path=tmp[0],size=tmp[1],content=tmp[2],filename;
                    tmp=path.split("/");
                    filename=tmp[tmp.length-1];
                    if(path.indexOf(dir)!=-1){
                        var flag=1;
                        for(j in text)if((path.indexOf(text[j])==-1) && (content.indexOf(text[j])==-1))flag=0;
                        if(flag==0)continue;
                        ++tot;
                        var link=path,icon=icon_other;
                        if(filename.indexOf("cpp")!=-1)icon=icon_cpp,link="javascript:viewcode('cpp','/"+path+"')";
                        else if(filename.indexOf("md")!=-1)icon=icon_markdown,link="javascript:viewmd('/"+path+"')";
                        link=link.replace('\n','');
                        var t="<li href=\""+link+"\" class='mdui-list-item mdui-ripple obj'>\
                                    <i class='mdui-list-item-avatar mdui-color-white'>"+icon+"</i>\
                                    <a href=\""+link+"\" class='mdui-list-item-content'>\
                                        <div class='mdui-list-item-title'>"+filename+"</div>\
                                        <div class='mdui-list-item-text'>2020-02-01 20:31</div>\
                                    </a>\
                                    <i class='mdui-list-item'>"+size+"KB</i>\
                                </li>";
                        $('#list').append(t);
                    }
                    $("#path").html("在"+dir+"的搜索结果,共"+tot+"个");
                }
            }
            search();
        </script>
        <script src="/add/mdui/js/mdui.min.js"></script>
    </div>

    <style>
        #content-left {
            text-align: left;
            width: 30%;
            height: 100%;
            float: left;
            clear: left;
            position: fixed;
            left: 0;
            top: 0;
            overflow-x: scroll;
            overflow-y: scroll;
        }

        #content-right {
            text-align: left;
            width: 70%;
            height: 100%;
            float: right;
            clear: right;
            position: fixed;
            top: 0;
            right: 0;
            overflow-x: scroll;
            overflow-y: scroll;
        }

        /* chrome */
        .left-body::-webkit-scrollbar,#path::-webkit-scrollbar{
            display: none;
        }
        /* firefox */
        .left-body,#path{
            scrollbar-color: transparent transparent;
            scrollbar-track-color: transparent;
            -ms-scrollbar-track-color: transparent;
        }
    </style>

    <!-- 鼠标点击特效 -->
    <script type="text/javascript" src="/add/mouse.js"></script>

    <!--custom-->
    <link rel="stylesheet" href="/add/custom.css" type="text/css">
</body>

</html>